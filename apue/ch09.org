#+title: 进程关系

* 概念

- init 进程：PID 为 1 的进程
- 进程组、会话

  [[./group&session.png]]

* 终端登录过程

** 非网络

1. init fork 若干子进程（每个设备一个），exec getty
2. 有用户通过某设备登录时，相应的进程 exec login
3. login 之后运行 shell

** 网络

*无法预先知道会有多少设备登录，因此是等待网络连接之后才进行后续操作*

1. init 启动一个守护进程 a（比如 inetd）
2. 每出现一个网络连接，守护进程就 fork 一个子进程 b（比如telnetd）
3. b 打开伪终端并 fork，父进程负责通信，子进程 login

* shell 执行程序

1. shell fork，得到进程 a
2. 如果是 bash，对于 pipe 中的每条命令，a 都 fork 一个子进程，并 exec
3. 如果是 sh，对于 pipe 中除最后一条命令以外的命令，a 都 fork 一个子进程 exec，然后 a 自己 exec 最后一条命令

* 孤儿进程组

*组内的所有成员都满足，要么父进程在组内，要么父进程在会话外，总之没有一个父进程在同会话的其它组内*

1. 向孤儿进程组中所有处于停止状态的进程发送挂断信号
2. 然后再发送继续信号
